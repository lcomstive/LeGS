name: Documentation

on: [ push, pull_request ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:

    # Checkout
    - uses: actions/checkout@v3

    # Get project version from package.json
    - name: Get Project Version
      run:  |
        JSON=$(cat package.json) \
        REGEX="\"version\":\\s?\"(([0-9]\\.?)+)\"" \
        if [[ $JSON =~ $REGEX ]] then \
          echo "PROJECT_NUMER=${BASH_REMATCH[1]}" >> Documentation/Doxyfile \
        fi

    # Generate HTML
    - name: Doxygen
      uses: mattnotmitt/doxygen-action@v1.9.2
      with:
        doxyfile-path: 'Documentation/Doxyfile'

    # Copy Documentation/Markdown/Media directory into Documentation/html for publishing
    - name: Copy media
      run: sudo cp -R Documentation/Markdown/Media Documentation/html/Media
    
    # Upload HTML to GitHub Pages site
    - name: Publish
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: Documentation/html
